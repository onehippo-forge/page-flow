<!DOCTYPE html>
    <!--
 | Generated by Apache Maven Doxia Site Renderer 1.7.4 at 6 Apr 2018 
 | Rendered using Hippo Forge Maven Skin 2.0.1 based on Apache Maven Fluido Skin
-->

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                  <meta name="Date-Revision-yyyymmdd" content="20180406" />
              <meta http-equiv="Content-Language" content="en" />
      <title>Hippo Forge Page Flow &#x2013; </title>
  <link rel="stylesheet" href="./css/forge-maven-skin-syntaxhighlighter-2.0.1.min.css"/>
  <link rel="stylesheet" href="./css/forge-maven-skin-2.0.1.min.css"/>
  <link rel="stylesheet" href="./css/site.css" />
  <link rel="stylesheet" href="./css/print.css" media="print" />
  
  <script type="text/javascript" src="./js/forge-maven-skin-syntaxhighlighter-2.0.1.min.js"></script>
  <script type="text/javascript" src="./js/forge-maven-skin-2.0.1.min.js"></script>

    </head>
<body class="topBarDisabled">
                        <a href="https://github.com/onehippo-forge/page-flow">
    <img style="position: absolute; top: 0; right: 0; border: 0; z-index: 10000;"
         src="https://s3.amazonaws.com/github/ribbons/forkme_right_green_007200.png"
         alt="Fork me on GitHub">
  </a>
          <div class="container-fluid">
  <div id="banner">
    <div id="logo">
      <a href="http://www.github.com/onehippo-forge">
        <img src="./images/hipposkin/hippo-forge-logo.png" alt="Hippo Forge Logo" />
      </a>
    </div>
    <div class="pull-left">              <div id="bannerLeft">    <h1>Page Flow</h1>
    </div>
              </div>
    <div class="pull-right"></div>
    <div class="clear"><hr/></div>
  </div>

  <div id="breadcrumbs">
    <div class="links">
      <a href="https://www.bloomreach.com">bloomreach.com</a>
      <a href="https://www.onehippo.org">onehippo.org</a>
    </div>
    <ul class="breadcrumb">
    
  <li id="publishDate">published: 6 Apr 2018  
  </li>
  
        
            </ul>
    <div class="clear"><hr/></div>
  </div>
<div class="row-fluid">
  <div id="leftColumn" class="span2">
    <div class="well sidebar-nav">
    
    <ul class="nav nav-list">
            <li>  <a href="index.html" title="Home">  <span class="none"></span>  Home</a>  </li>
        <li>  <a href="demoproject.html" title="Demo Project">  <span class="none"></span>  Demo Project</a>  </li>
        <li>  <a href="install.html" title="Installation">  <span class="none"></span>  Installation</a>  </li>
        <li class="active">  <a href="#"><span class="none"></span>Configuration</a>
  </li>
        <li>  <a href="dev-howto.html" title="Developer's How-to">  <span class="none"></span>  Developer's How-to</a>  </li>
        <li>  <a href="apidocs/index.html" title="JavaDocs">  <span class="none"></span>  JavaDocs</a>  </li>
        <li>  <a href="release-notes.html" title="Release Notes">  <span class="none"></span>  Release Notes</a>  </li>
        </ul>
    
          <hr />
      <div id="poweredBy">
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
                <div class="clear"></div>
              <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">  <img class="builtBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />  </a>
          </div>
    </div>
  </div>
  <div id="bodyColumn"  class="span10" >
    <div class="section">
<h2><a name="Configuration"></a>Configuration</h2>
<div class="section">
<h3><a name="Introduction"></a>Introduction</h3>
<p>Configurations include two parts:</p>

<ol style="list-style-type: decimal">
  
<li>Configure <b>Page Flow HstSiteMapItemHandler ID</b> (<tt>defaultpageflowcontrolhandler</tt> by default)  for a mount or sitemap item.</li>
  
<li>Configure <b>Page Flow Definition ID</b> for a channel, mount or sitemap item.</li>
  
<li>(Optional) Configure <b>Page Flow Channel Info</b> for a channel.</li>
</ol>
<p><b>Page Flow HstSiteMapItemHandler ID</b> (<tt>defaultpageflowcontrolhandler</tt> by default) must be configured in either mount level or sitemap item level. So, Page Flow Module can handle automatic initiation, redirection, etc. for a visitor based on the visitor&#x2019;s Page Flow instance lifecycle.</p>
<p>Also, <b>Page Flow Definition ID</b> must be configured in a channel, mount or sitemap item level. So, Page Flow Module will initialize and manage a Page Flow instance based on the configured Page Flow Definition ID.</p></div>
<div class="section">
<h3><a name="Configure_Page_Flow_HstSiteMapItemHandler_ID_defaultpageflowcontrolhandler_by_default_for_a_mount_or_sitemap_item"></a>Configure <b>Page Flow HstSiteMapItemHandler ID</b> (<tt>defaultpageflowcontrolhandler</tt> by default) for a mount or sitemap item</h3>
<p>One ore more <a class="externalLink" href="https://www.onehippo.org/library/concepts/hst-configuration-model/advanced/sitemapitem-handlers.html">HstSiteMapItemHandler</a>s can be configured in either mount level (<tt>@hst:defaultsitemapitemhandlerids</tt> property) or sitemap item level (<tt>@hst:sitemapitemhandlerids</tt> property).</p>
<p>It could be very convenient to configure the <tt>HstSiteMapItemHandler</tt> ID value in the mount level because the same <tt>HstSiteMapItemHandler</tt>s will be applied to all the resolved sitemap items under the same resolved mount. So, you don&#x2019;t need to configure the <tt>HstSiteMapItemHandler</tt> ID for each sitemap item configuration again and again. This is extremely useful when you have a channel that serves a Page Flow Module driven request processing. e.g, &#x201c;Identity Protection Product Campaign Microsite Channel&#x201d;.</p>
<p>However, if you want to control it in more granular level by having some sitemap items for other page serving, and having some other sitemap items for Page Flow Module driven request processing, then you might want to configure the the <tt>HstSiteMapItemHandler</tt> ID value in each sitemap item level for some selected sitemap items. e.g, &#x201c;/campaign1&#x201d;, &#x201c;/campaign1/<i>any</i>&#x201d;, &#x2026; In this case, make sure that you configured the <b>Page Flow HstSiteMapItemHandler ID</b> on all the possible sitemap items for Page Flow Module driven requests.</p>
<div class="section">
<h4><a name="Scenario_1:_Configure_Page_Flow_HstSiteMapItemHandler_ID_in_Mount_Level"></a>Scenario 1: Configure <b>Page Flow HstSiteMapItemHandler ID</b> in Mount Level</h4>
<p>Suppose you have an HST Mount configuration at <tt>/hst:hst/hst:hosts/dev-localhost/localhost/hst:root/campaign1</tt> which is associated with a channel called &#x201c;Campaign 1&#x201d;.</p>
<p>If you want the channel to be controlled by the Page Flow module, then simply add the registered HstSiteMapItemHandler name to the <tt>@hst:defaultsitemapitemhandlerids</tt> of the mount configuration like the following:</p>
<p>For example,</p>

<div class="source">
<div class="source"><pre>/campaign1:
  jcr:primaryType: hst:mount
  hst:defaultsitemapitemhandlerids: [defaultpageflowcontrolhandler]
  ...
</pre></div></div>
<p>Now, every request coming along to this mount will be controlled by <b>Page Flow Module</b>.</p></div>
<div class="section">
<h4><a name="Scenario_2:_Configure_Page_Flow_HstSiteMapItemHandler_ID_in_SiteMap_Item_Level"></a>Scenario 2: Configure <b>Page Flow HstSiteMapItemHandler ID</b> in SiteMap Item Level</h4>
<p>You can configure the <tt>@hst:sitemapitemhandlerids</tt> property on each sitemap item separately in this scenario. If you set the property on specific sitemap items, any requests onto the sitemap items will be controlled by <b>Page Flow Module</b>. Otherwise, Page Flow module wouldn&#x2019;t do anything for the other sitemap items.</p>
<p>For example,</p>

<div class="source">
<div class="source"><pre>/payment:
  jcr:primaryType: hst:sitemapitem
  hst:sitemapitemhandlerids: [defaultpageflowcontrolhandler]
  ...
</pre></div></div></div></div>
<div class="section">
<h3><a name="Configure_Page_Flow_Definition_ID_for_a_channel_mount_or_sitemap_item"></a>Configure <b>Page Flow Definition ID</b> for a channel, mount or sitemap item</h3>
<p>Once you published a <b>Page Flow Definition</b> document like shown in the <a href="demoproject.html">Demo Project</a>, you can associate the <b>Page Flow Definition ID</b> value (the <b>Flow ID</b> field value in the editor) to a channel, a mount or a sitemap item.</p>
<p>The default <b>PageFlowControl</b> implementation (<tt>org.onehippo.forge.pageflow.hst.sitemapitemhandler.DefaultHstPageFlowControl</tt>) resolves the current <b>Page Flow Definition ID</b> in the following order:</p>

<ol style="list-style-type: decimal">
  
<li>If the current servlet request has a non-blank string attribute by name, <tt>org.onehippo.forge.pageflow.core.rt.PageFlowControl.PAGE_FLOW_ID_ATTR_NAME</tt>,  then it is used.</li>
  
<li>Else if the current <tt>HttpSession</tt> has a non-blank string attribute by name, <tt>org.onehippo.forge.pageflow.core.rt.PageFlowControl.PAGE_FLOW_ID_ATTR_NAME</tt>,  then it is used.</li>
  
<li>Else If the current resolved sitemap item returns a non-blank value for a parameter named <tt>pageflowid</tt>, it is used.</li>
  
<li>Else if the current resolved mount is associated with a channel, and if the <tt>ChannelInfo</tt> class of the channel is type of <tt>org.onehippo.forge.pageflow.hst.channel.PageFlowSiteInfo</tt>,  and if the channel info object returns a non-blank value on <tt>PageFlowSiteInfo#getDefaultPageFlowId()</tt>,  then it is used.  If the <tt>ChannelInfo</tt> is not null but is not type of <tt>org.onehippo.forge.pageflow.hst.channel.PageFlowSiteInfo</tt>,  then the channel property named <tt>pageflowid</tt> will be read. If the value is non-blank, it is used.</li>
  
<li>Else if the resolved mount&#x2019;s mount property or normal property named <tt>pageflowid</tt> will be read. If not blank, it is used.</li>
  
<li>Otherwise, it will fail to resolve the current <b>Page Flow Definition ID</b>, and as a result all the Page Flow Module driven request processing will fail.</li>
</ol></div>
<div class="section">
<h3><a name="aOptional_Configure_Page_Flow_Channel_Info_for_a_channel"></a>(Optional) Configure <b>Page Flow Channel Info</b> for a channel</h3>
<p>When you configure a Page Flow Definition for a dedicated channel, you might also want to configure the Page Flow Definition through the Channel Setting window like the following:</p>

<blockquote>
<p><img src="images/flowchninfo.png" alt="Page Flow Channel Info" /></p>
</blockquote>
<p>So, you can simply copy <b>Flow ID</b> field value in the Page Flow Definition document and paste it into the <b>Default Page Flow ID</b> input shown above.</p>
<p><b>Page Flow Module</b> provides a default <a class="externalLink" href="https://www.onehippo.org/library/concepts/channels/define-channel-configuration-parameters.html">Channel Info</a>: <tt>org.onehippo.forge.pageflow.hst.channel.PageFlowSiteInfo</tt></p>
<p>To use this Channel Info, you can configure your channel configuration like the following:</p>

<div class="source">
<div class="source"><pre>/hst:channel:
  jcr:primaryType: hst:channel
  hst:channelinfoclass: org.onehippo.forge.pageflow.hst.channel.PageFlowSiteInfo
  ...
</pre></div></div></div></div>
    </div>
    </div>
    </div>
    <hr/>
    <footer>
    <div class="container-fluid">
      <div class="row-fluid">
          <p class="copyright">Copyright &copy;      2018.
  Hippo B.V. All rights reserved.
</p>
    </div>
            </div>
  </footer>
    </body>
</html>

